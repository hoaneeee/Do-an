<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Form mở tài khoản ngân hàng</title>
  <style>
    :root{
      --bg: #0f172a;          /* slate-900 */
      --panel: rgba(15, 23, 42, 0.65);
      --card: #111827aa;
      --brand: #22c55e;       /* green-500 */
      --ink: #e5e7eb;         /* text */
      --muted: #94a3b8;       /* slate-400 */
      --line: #1f2937;        /* border */
      --danger: #ef4444;      /* red-500 */
      --success: #10b981;     /* emerald-500 */
      --focus: #60a5fa;       /* blue-400 */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:
        radial-gradient(80vmax 40vmax at -10% -10%, #1f2937, transparent 60%),
        radial-gradient(70vmax 40vmax at 110% 0%, #064e3b, transparent 55%),
        linear-gradient(180deg, #020617, #0b1020);
      color:var(--ink);
      font: 16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      display:grid;
      place-items:center;
      padding:24px;
    }
    .container{
      width:min(920px, 100%);
      display:grid;
      gap:24px;
    }
    .header{
      display:flex;
      align-items:center;
      gap:16px;
    }
    .logo{
      width:44px;height:44px;border-radius:14px;
      display:grid;place-items:center;
      background:linear-gradient(135deg, #16a34a, #22c55e);
      box-shadow:0 10px 30px rgba(34,197,94,.35), inset 0 0 1px #fff3;
    }
    .logo svg{filter:drop-shadow(0 1px 1px rgba(0,0,0,.3))}
    .title h1{margin:0;font-size:clamp(20px, 3vw, 28px)}
    .title p{margin:2px 0 0;color:var(--muted)}
    .card{
      background: linear-gradient(180deg, #0b1224aa, #0d1428aa);
      border:1px solid #ffffff14;
      border-radius:20px;
      box-shadow: 0 8px 30px rgba(2,6,23,.45), inset 0 1px 0 #ffffff20;
      padding:24px;
      backdrop-filter: blur(12px);
    }
    form{display:grid;grid-template-columns:1fr 1fr; gap:18px}
    @media (max-width: 760px){ form{grid-template-columns:1fr} }
    .field{display:flex;flex-direction:column; gap:8px}
    .field label{font-weight:600; font-size:14px; color:#cbd5e1}
    .control{
      position:relative;
      display:flex; align-items:center;
      border:1px solid #ffffff1a;
      border-radius:14px;
      padding:10px 12px;
      background: #0b122480;
      transition: border-color .2s, box-shadow .2s, background .2s;
    }
    .control:focus-within{
      border-color: var(--focus);
      box-shadow: 0 0 0 3px #60a5fa33;
      background: #0b1224b0;
    }
    .control input, .control select{
      width:100%; border:0; outline:0; background:transparent; color:var(--ink);
      font-size:16px;
    }
    .hint{font-size:12px;color:var(--muted);}
    .error-msg{font-size:13px;color:var(--danger); min-height:18px}
    .row-span-2{grid-column: span 2}
    @media (max-width: 760px){ .row-span-2{grid-column: auto} }
    .checkbox{
      display:flex; align-items:flex-start; gap:12px; padding:12px 0;
      border-top:1px solid #ffffff10; margin-top:6px;
    }
    .checkbox input{ transform: translateY(2px) }
    .actions{
      display:flex; gap:12px; align-items:center; justify-content:flex-end; margin-top:8px;
    }
    .btn{
      border:0; border-radius:14px; padding:12px 18px; font-weight:700;
      background: linear-gradient(135deg, #16a34a, #22c55e);
      color:white; cursor:pointer;
      box-shadow: 0 12px 30px rgba(34,197,94,.35);
      transition: transform .08s ease, box-shadow .2s ease;
    }
    .btn:hover{ transform: translateY(-1px) }
    .btn:active{ transform: translateY(0) scale(.98) }
    .badge{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 12px; border-radius:999px; font-size:13px;
      background:#065f4633; color:#a7f3d0; border:1px solid #34d39955;
    }
    #result{margin:8px 0 0; font-weight:600}
    #result.error{color:var(--danger)}
    #result.success{color:var(--success)}
    .footer{color:#93c5fd;font-size:12px; text-align:center}
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="logo" aria-hidden="true">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M4 12c0-4.418 3.582-8 8-8 3.314 0 6.152 2.013 7.352 4.873L12 22 4 12z" fill="white" opacity=".9"/>
        </svg>
      </div>
      <div class="title">
        <h1>Mở tài khoản ngân hàng trực tuyến</h1>
        <p class="badge">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M12 2l9 6v2H3V8l9-6zm0 20l-9-6v-6l9 6 9-6v6l-9 6z" stroke="#a7f3d0" />
          </svg>
          Bảo mật &amp; an toàn
        </p>
      </div>
    </div>

    <div class="card">
      <form id="openForm" novalidate>
        <div class="field">
          <label for="fullname">Họ và tên *</label>
          <div class="control"><input id="fullname" type="text" placeholder="Ví dụ: Nguyễn Văn A" /></div>
          <div class="hint">Nhập đầy đủ họ tên ghi trên giấy tờ.</div>
          <div class="error-msg" id="err_fullname"></div>
        </div>

        <div class="field">
          <label for="cmnd">Số CMND/CCCD *</label>
          <div class="control"><input id="cmnd" inputmode="numeric" maxlength="12" placeholder="12 số" /></div>
          <div class="hint">Phải đủ 12 số, không có ký tự khác.</div>
          <div class="error-msg" id="err_cmnd"></div>
        </div>

        <div class="field">
          <label for="phone">Số điện thoại *</label>
          <div class="control"><input id="phone" inputmode="numeric" maxlength="10" placeholder="Bắt đầu bằng 0, đủ 10 số" /></div>
          <div class="hint">Ví dụ: 0987654321</div>
          <div class="error-msg" id="err_phone"></div>
        </div>

        <div class="field">
          <label for="email">Email *</label>
          <div class="control"><input id="email" type="email" placeholder="ví dụ: ten@gmail.com" /></div>
          <div class="hint">Dùng email đang hoạt động để nhận thông báo.</div>
          <div class="error-msg" id="err_email"></div>
        </div>

        <div class="field row-span-2">
          <label for="accountType">Loại tài khoản *</label>
          <div class="control">
            <select id="accountType">
              <option value="">-- Chọn loại tài khoản --</option>
              <option>Thanh toán</option>
              <option>Tiết kiệm</option>
              <option>Doanh nghiệp</option>
            </select>
          </div>
          <div class="error-msg" id="err_accountType"></div>
        </div>

        <div class="row-span-2">
          <label class="checkbox">
            <input id="agree" type="checkbox" />
            <span>Tôi đã đọc và đồng ý với <u>Điều khoản dịch vụ</u> và <u>Chính sách bảo mật</u>.</span>
          </label>
          <div class="error-msg" id="err_agree"></div>
        </div>

        <div class="actions row-span-2">
          <button id="submit" type="submit" class="btn">Gửi đăng ký</button>
        </div>

        <p id="result" aria-live="polite"></p>
      </form>
    </div>

    <div class="footer">© 2025 GreenBank. Demo cho mục đích học tập.</div>
  </div>

  <script>
    // ====== "CSDL" đơn giản bằng localStorage để kiểm tra CMND trùng giữa các lần submit / reload ======
    function loadCMNDs(){
      try{
        const raw = localStorage.getItem('bank_cmnds');
        return raw ? new Set(JSON.parse(raw)) : new Set();
      }catch(e){ return new Set(); }
    }
    function saveCMNDs(set){
      try{
        localStorage.setItem('bank_cmnds', JSON.stringify(Array.from(set)));
      }catch(e){}
    }
    const cmndDB = loadCMNDs();

    // ====== Helpers hiển thị lỗi ======
    const MSG = {
      success: "Mở tài khoản thành công",
      nameRequired: "Họ và tên là bắt buộc",
      cmndLen: "CMND phải đủ 12 số",
      cmndDup: "CMND đã tồn tại",
      phoneInvalid: "Số điện thoại không hợp lệ",
      emailInvalid: "Email không hợp lệ",
      accountRequired: "Vui lòng chọn loại tài khoản",
      agreeRequired: "Bạn phải đồng ý điều khoản dịch vụ"
    };

    const resultEl = document.getElementById('result');
    function showResult(message, ok){
      resultEl.className = ok ? 'success' : 'error';
      resultEl.textContent = message;
    }
    function clearErrors(){
      ['fullname','cmnd','phone','email','accountType','agree'].forEach(id=>{
        const el = document.getElementById('err_'+id);
        if(el) el.textContent = '';
      });
      resultEl.textContent = '';
      resultEl.className='';
    }

    // ====== Validation logic ======
    function validate(values){
      clearErrors();
      const errs = {};
      if(!values.fullname) errs.fullname = MSG.nameRequired;
      if(!/^[0-9]{12}$/.test(values.cmnd)) errs.cmnd = MSG.cmndLen;
      else if(cmndDB.has(values.cmnd)) errs.cmnd = MSG.cmndDup;
      if(!/^0[0-9]{9}$/.test(values.phone)) errs.phone = MSG.phoneInvalid;
      if(!/^[\\w.-]+@[\\w.-]+\\.[a-zA-Z]{2,}$/.test(values.email)) errs.email = MSG.emailInvalid;
      if(!values.accountType) errs.accountType = MSG.accountRequired;
      if(!values.agree) errs.agree = MSG.agreeRequired;
      return errs;
    }

    function getValues(){
      return {
        fullname: document.getElementById('fullname').value.trim(),
        cmnd: document.getElementById('cmnd').value.trim(),
        phone: document.getElementById('phone').value.trim(),
        email: document.getElementById('email').value.trim(),
        accountType: document.getElementById('accountType').value,
        agree: document.getElementById('agree').checked
      };
    }

    function showErrors(errs){
      for(const k in errs){
        const el = document.getElementById('err_'+k);
        if(el) el.textContent = errs[k];
      }
      // Ưu tiên hiển thị thông báo tổng (#result) theo thứ tự rule như đề bài
      const ordered = ['fullname','cmnd','phone','email','accountType','agree'];
      for(const key of ordered){
        if(errs[key]){ showResult(errs[key], false); break; }
      }
    }

    // ====== Live validation nho nhỏ ======
    [['fullname','input'],['cmnd','input'],['phone','input'],['email','input'],['accountType','change'],['agree','change']]
      .forEach(([id,evt])=>{
        const el = document.getElementById(id);
        el.addEventListener(evt, ()=>{
          // chỉ xóa lỗi khi người dùng chỉnh
          const errs = validate(getValues());
          if(!errs[id]){
            const e = document.getElementById('err_'+id);
            if(e) e.textContent = '';
            resultEl.textContent='';
          }
        });
      });

    // ====== Submit ======
    document.getElementById('openForm').addEventListener('submit', function(e){
      e.preventDefault();
      const values = getValues();
      const errs = validate(values);
      if(Object.keys(errs).length){
        showErrors(errs);
        return;
      }
      // Thành công
      cmndDB.add(values.cmnd);
      saveCMNDs(cmndDB);
      showResult(MSG.success, true);

      // (Demo) reset nhẹ nhàng trừ CMND để Selenium test duplicate có dữ liệu
      this.reset();
      document.getElementById('accountType').value='';
    });
  </script>
</body>
</html>
